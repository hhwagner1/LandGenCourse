<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Week 5: Spatial Statistics • LandGenCourse</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Week 5: Spatial Statistics">
<meta property="og:description" content="LandGenCourse">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-168837293-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-168837293-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">LandGenCourse</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.4.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Week0_BasicR.html">Week 0: Intro to R Programming</a>
    </li>
    <li>
      <a href="../articles/Week0_Graphics.html">Week 0: R Graphics</a>
    </li>
    <li>
      <a href="../articles/Week1_vignette.html">Week 1: Importing Genetic Data</a>
    </li>
    <li>
      <a href="../articles/Week2_vignette.html">Week 2: Spatial Data</a>
    </li>
    <li>
      <a href="../articles/Week2_bonus_vignette.html">Week 2: Bonus Material</a>
    </li>
    <li>
      <a href="../articles/Week3_vignette.html">Week 3: Genetic Diversity</a>
    </li>
    <li>
      <a href="../articles/Week4_vignette.html">Week 4: Metapopulation Genetics</a>
    </li>
    <li>
      <a href="../articles/Week5_vignette.html">Week 5: Spatial Statistics</a>
    </li>
    <li>
      <a href="../articles/Week6_vignette.html">Week 6: Quantitative Genetics</a>
    </li>
    <li>
      <a href="../articles/Week7_vignette.html">Week 7: Spatial Linear Models</a>
    </li>
    <li>
      <a href="../articles/Week8_vignette.html">Week 8: Simulation</a>
    </li>
    <li>
      <a href="../articles/Week8_bonus_vignette.html">Week 8: Bonus Material</a>
    </li>
    <li>
      <a href="../articles/Week9_vignette.html">Week 9: Population Structure</a>
    </li>
    <li>
      <a href="../articles/Week10_vignette.html">Week 10: Landscape Resistance</a>
    </li>
    <li>
      <a href="../articles/Week11_vignette.html">Week 11: Detecting Adaptation</a>
    </li>
    <li>
      <a href="../articles/Week12_vignette.html">Week 12: Model Selection</a>
    </li>
    <li>
      <a href="../articles/Week13_vignette.html">Week 13: Gravity Models</a>
    </li>
    <li>
      <a href="../articles/Week14_vignette.html">Week 14: Contemporary Gene Flow</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../tutorials/00-Intro_RStudio.html">Introduction to RStudio</a>
    </li>
    <li>
      <a href="../tutorials/00-Intro_LandGenCourse.html">Introduction to the LandGenCourse package</a>
    </li>
    <li>
      <a href="../tutorials/00-Intro_RNotebooks.html">Introduction to R Notebooks</a>
    </li>
    <li>
      <a href="../tutorials/00-Version_Control.html">Version Control 101</a>
    </li>
    <li>
      <a href="../tutorials/01-Genetic_Data.html">Week 1 Getting Landscape Genetic Data into R</a>
    </li>
    <li>
      <a href="../tutorials/02-Spatial_Data.html">Week 2 Land Cover Analysis in R</a>
    </li>
    <li>
      <a href="../tutorials/03-Genetic_Diversity.html">Week 3 Genetic Diversity (Part 1)</a>
    </li>
    <li>
      <a href="../tutorials/03-Genetic_Diversity_Part2.html">Week 3 Genetic Diversity (Part 2)</a>
    </li>
    <li>
      <a href="../tutorials/04-Metapop_Genetics.html">Week 4 Metapopulation Genetics (Part 1)</a>
    </li>
    <li>
      <a href="../tutorials/04-Metapop_Genetics_Part2.html">Week 4 Metapopulation Genetics (Part 2)</a>
    </li>
    <li>
      <a href="../tutorials/05-Spatial_Stats.html">Week 5 Spatial Statistics</a>
    </li>
    <li>
      <a href="../tutorials/06-Quantitative_Genetics.html">Week 6 Quantitative Genetics (Part 1)</a>
    </li>
    <li>
      <a href="../tutorials/06-Quantitative_Genetics_Part2.html">Week 6 Quantitative Genetics (Part 1)</a>
    </li>
    <li>
      <a href="../tutorials/07-Spatial_Models.html">Week 7 Spatial Linear Models (Part 1)</a>
    </li>
    <li>
      <a href="../tutorials/07-Spatial_Models_Part2.html">Week 7 Spatial Linear Models (Part 2)</a>
    </li>
    <li>
      <a href="../tutorials/08-Modeling.html">Week 8 Simulation Experiments in R (Part 1)</a>
    </li>
    <li>
      <a href="../tutorials/08-Modeling_Part2.html">Week 8 Simulation Experiments in R (Part 1)</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Week 5: Spatial Statistics</h1>
                        <h4 class="author">Helene Wagner</h4>
            
            <h4 class="date">2020-06-08</h4>
      
      
      <div class="hidden name"><code>Week5_vignette.Rmd</code></div>

    </div>

    
    
<div id="overview-of-worked-example" class="section level2">
<h2 class="hasAnchor">
<a href="#overview-of-worked-example" class="anchor"></a>1. Overview of Worked Example</h2>
<div id="a-goals" class="section level3">
<h3 class="hasAnchor">
<a href="#a-goals" class="anchor"></a>a) Goals</h3>
<p>This worked example shows how to:</p>
<ul>
<li>Calculate genetic distance at population level.</li>
<li>Perform a Mantel test to test for IBD.</li>
<li>Create Mantel correlograms for the genetic data.</li>
<li>Calculate and test Moran’s I for population-level genetic diversity data.</li>
</ul>
</div>
<div id="b-data-set" class="section level3">
<h3 class="hasAnchor">
<a href="#b-data-set" class="anchor"></a>b) Data set</h3>
<p>This is a larger version of the frog data set used in Weeks 1 - 3.</p>
<p>Here, we will analyze microsatellite data from Funk et al. (2005) and Murphy et al. (2010) for 418 individuals of Colombia spotted frogs (Rana luteiventris) from 30 populations, together with site-level spatial coordinates. Please see the introductory video on the DGS course website, R lab page.</p>
<ul>
<li>
<strong>ralu_loci_allpops.csv</strong>: Data frame with populations and genetic data (406 rows x 9 columns). Included as external file in package <code>LandGenCourse</code>.</li>
<li>
<strong>Frogs_diversity_allpops.csv</strong>: Table with genetic diversity variables similar to Week 3.</li>
<li>
<strong>ralu_coords_allpops.csv</strong>: Spatial coordinates (both in UTM and LongLat format), and basin.</li>
</ul>
</div>
<div id="c-required-r-libraries" class="section level3">
<h3 class="hasAnchor">
<a href="#c-required-r-libraries" class="anchor"></a>c) Required R libraries</h3>
<p>All required packages should have been installed already when you installed ‘LandGenCourse’.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">LandGenCourse</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">GeNetIt</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">EcoGenetics</span>)
<span class="co">#require(adegenet)</span>
<span class="co">#require(tibble)</span>
<span class="co">#require(gstudio)</span>
<span class="co">#require(hierfstat)</span>
<span class="co">#require(PopGenReport)</span>
<span class="co">#require(mmod)</span>
<span class="co">#require(spdep)</span></pre></body></html></div>
</div>
</div>
<div id="data-import-and-manipulation" class="section level2">
<h2 class="hasAnchor">
<a href="#data-import-and-manipulation" class="anchor"></a>2. Data import and manipulation</h2>
<div id="a-create-an-ecogen-object" class="section level3">
<h3 class="hasAnchor">
<a href="#a-create-an-ecogen-object" class="anchor"></a>a) Create an ecogen object</h3>
<p>Import the site data that we used before in Week 2.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">Frogs.coords</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"ralu_coords_allpops.csv"</span>,
                                     <span class="kw">package</span> <span class="kw">=</span> <span class="st">"LandGenCourse"</span>))</pre></body></html></div>
<p>In Week 3, we calculated population-level genetic data as a table <code>Frogs.diversity</code>. Here we import a table with the same diversity measures for all 29 sites from a system file in <code>LandGenCourse</code>.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">Frogs.diversity</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"Frogs_diversity_allpops.csv"</span>,
                                     <span class="kw">package</span> <span class="kw">=</span> <span class="st">"LandGenCourse"</span>))</pre></body></html></div>
<p>Import the genetic data for 29 sites:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">Frogs.loci</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"ralu_loci_allpops.csv"</span>,
                                     <span class="kw">package</span> <span class="kw">=</span> <span class="st">"LandGenCourse"</span>))</pre></body></html></div>
<p>We start building an <code>ecogen</code> object by assigning the genetic data to the <code>G</code> slot, and the structure (i.e., hierarchical sampling information, here site names) to the <code>S</code> slot. For the genetic data, we need to specify the type of data and coding.</p>
<p>Note the tweak using <code>data.frame</code> when specifying <code><a href="https://rdrr.io/r/base/data.frame.html">data.frame(ralu.loci[,1:2])</a></code>. This is necessary to import the multiple columns correctly and with their original names.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">Frogs.ecogen</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/ecogen.html">ecogen</a></span>(<span class="kw">G</span> <span class="kw">=</span> <span class="no">Frogs.loci</span>[,-<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>:<span class="fl">2</span>)], <span class="kw">ploidy</span> <span class="kw">=</span> <span class="fl">2</span>,
                       <span class="kw">type</span> <span class="kw">=</span> <span class="st">"codominant"</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">":"</span>,
                       <span class="kw">S</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="no">Frogs.loci</span>[,<span class="fl">1</span>:<span class="fl">2</span>]))
<span class="no">Frogs.ecogen</span></pre></body></html></div>
<pre><code>## 
##                    || ECOGEN CLASS OBJECT ||
## ----------------------------------------------------------------------------
##  Access to slots: &lt;ecoslot.&gt; + &lt;name of the slot&gt; + &lt;(name of the object)&gt; 
##  See: help("EcoGenetics accessors")
## ----------------------------------------------------------------------------
## 
##  | slot XY:    | --&gt; 0 x 0          coordinates
##  | slot P:     | --&gt; 0 x 0          phenotypic variables
##  | slot G:     | --&gt; 413 x 8        loci         &gt;&gt; ploidy: 2 || codominant
##  | slot A:     | --&gt; 413 x 43       alleles
##  | slot E:     | --&gt; 0 x 0          environmental variables
##  | slot S:     | --&gt; 413 x 2        structures   &gt;&gt; 2 structures found
##  | slot C:     | --&gt; 0 x 0          variables
##  | slot OUT:   | --&gt; 0              results
## ----------------------------------------------------------------------------</code></pre>
<p>The summary confirms that we now have data in the <code>S</code> and <code>G</code> slots. In addition, EcoGenetics created a table of absolute frequencies (i.e. counts) of alleles for each individual in slot <code>A</code>.</p>
</div>
<div id="b-aggregate-to-ecopop" class="section level3">
<h3 class="hasAnchor">
<a href="#b-aggregate-to-ecopop" class="anchor"></a>b) Aggregate to ecopop</h3>
<p>Most of our analysis for this lab will be at the population level. The function <code>ecogen2ecopop</code> aggregates from individual to population-level data.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">Frogs.ecopop</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/ecogen2ecopop.html">ecogen2ecopop</a></span>(<span class="no">Frogs.ecogen</span>, <span class="kw">hier</span> <span class="kw">=</span> <span class="st">"SiteName"</span>)
<span class="no">Frogs.ecopop</span></pre></body></html></div>
<pre><code>## 
##                    &lt;&lt; ECOPOP CLASS OBJECT &gt;&gt;
## ****************************************************************************
##  Access to slots: &lt;ecoslot.&gt; + &lt;name of the slot&gt; + &lt;(name of the object)&gt; 
##  See: help("EcoGenetics accessors")
## ****************************************************************************
## 
##  # slot XY:    # =&gt;  0 x 0          coordinates
##  # slot P:     # =&gt;  0 x 0          phenotypic variables
##  # slot AF:    # =&gt;  30 x 43        loci         &gt;&gt; ploidy: 2 || codominant
##  # slot E:     # =&gt;  0 x 0          environmental variables
##  # slot S:     # =&gt;  30 x 1         population found
##  # slot C:     # =&gt;  0 x 0          variables
## ****************************************************************************</code></pre>
<p>Instead of 413 individuals, we now have data for 30 populations. Slot <code>AF</code> contains the population-level absolute frequencies (counts) of alleles.</p>
</div>
<div id="b-add-site-level-data" class="section level3">
<h3 class="hasAnchor">
<a href="#b-add-site-level-data" class="anchor"></a>b) Add site-level data</h3>
<p>Before importing the genetic diversity, spatial coordinates and site data into the <code>ecopop</code> object, we need to match the rows and extract the data for the sampled populations.</p>
<p>Unfortunately, the datasets use different versions of the site name, both were include in the file <code>ralu_loci_allpops.csv</code> and thus in the <code>S</code> slot of <code>Frogs.ecogen</code>.</p>
<ul>
<li>Here, we use <code>group_by</code> and <code>summarize</code> to get the unique set of site names in both versions. We save it as a data frame Subset.</li>
<li>Then we join the genetic diversity data. Because the two data frames share a common variable, we dont’ need to specify the argument <code>by</code>. R will confirm what ID variable it used to join.</li>
</ul>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">Subset</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.S</a></span>(<span class="no">Frogs.ecogen</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">SiteName</span>, <span class="no">Pop</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>()
<span class="no">Subset</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(<span class="no">Subset</span>, <span class="no">Frogs.diversity</span>)</pre></body></html></div>
<pre><code>## Joining, by = "Pop"</code></pre>
<p>R tells us that it used the shared ID variable <code>Pop</code> to join the data.</p>
<p>Now we can join the site data. Note: with <code>as.data.frame</code>, we combine the <span class="citation">@data</span> and <span class="citation">@coords</span> slots of the SpatialPointsDataFrame <code>ralu.site</code> to a single data frame.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">Subset</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(<span class="no">Subset</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="no">Frogs.coords</span>))</pre></body></html></div>
<pre><code>## Joining, by = "SiteName"</code></pre>
<p>This time, R used the shared ID variable <code>SiteName</code> to join the data.</p>
<p>Now we have all site-level data in the data frame <code>Subset</code> that has the same row names as <code>Frogs.ecopop</code>. We check the names of the variables to decide which ones to put where. Then we assign them to their respective slots (<span class="citation">@C</span> for the custom data, here genetic diversity, <span class="citation">@E</span> for the environmental data, and <span class="citation">@XY</span> for the coordinates).</p>
<p>The argument pop specifies the matching ID variable in the <span class="citation">@S</span> slot. When we aggregated from <code>Frogs.ecogen</code> to <code>Frogs.ecopop</code>, unfortunately EcoGenetics renamed the variable <code>SiteName</code> to <code>pop</code>. The argument <code>pop_levels</code> identifies the corresponding ID variable in <code>Subset</code>.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">Subset</span>)</pre></body></html></div>
<pre><code>##  [1] "SiteName"  "Pop"       "n"         "Hobs"      "Hexp"      "Ar"       
##  [7] "UTM83_E"   "UTM83_N"   "Longitude" "Latitude"  "Basin"</code></pre>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">Frogs.ecopop</span> <span class="kw">&lt;-</span> <span class="kw pkg">EcoGenetics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/eco.fill_ecogen_with_df.html">eco.fill_ecogen_with_df</a></span>(<span class="no">Frogs.ecopop</span>,
             <span class="kw">pop</span> <span class="kw">=</span><span class="st">"pop"</span>, <span class="kw">pop_levels</span> <span class="kw">=</span> <span class="no">Subset</span>$<span class="no">SiteName</span>,
             <span class="kw">C</span> <span class="kw">=</span> <span class="no">Subset</span>[,<span class="fl">3</span>:<span class="fl">6</span>],
             <span class="kw">XY</span> <span class="kw">=</span> <span class="no">Subset</span>[,<span class="fl">7</span>:<span class="fl">10</span>])
<span class="no">Frogs.ecopop</span></pre></body></html></div>
<pre><code>## 
##                    &lt;&lt; ECOPOP CLASS OBJECT &gt;&gt;
## ****************************************************************************
##  Access to slots: &lt;ecoslot.&gt; + &lt;name of the slot&gt; + &lt;(name of the object)&gt; 
##  See: help("EcoGenetics accessors")
## ****************************************************************************
## 
##  # slot XY:    # =&gt;  30 x 4         coordinates
##  # slot P:     # =&gt;  0 x 0          phenotypic variables
##  # slot AF:    # =&gt;  30 x 43        loci         &gt;&gt; ploidy: 2 || codominant
##  # slot E:     # =&gt;  0 x 0          environmental variables
##  # slot S:     # =&gt;  30 x 1         population found
##  # slot C:     # =&gt;  30 x 4         variables
## ****************************************************************************</code></pre>
</div>
<div id="c-export-to-adegenet-and-gstudio" class="section level3">
<h3 class="hasAnchor">
<a href="#c-export-to-adegenet-and-gstudio" class="anchor"></a>c) Export to adegenet and gstudio</h3>
<p>‘EcoGenetics’ provides convenient functions for converting genetic data to and from other packages.</p>
<p>Import into ‘genind’ object (package ‘adegenet’): there is a dedicated function, but we need to separately declare the variable that represents the populations and write it into the <span class="citation">@pop</span> slot of the ‘genind’ object.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">Frogs.genind</span> <span class="kw">&lt;-</span> <span class="kw pkg">EcoGenetics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/ecogen2genind.html">ecogen2genind</a></span>(<span class="no">Frogs.ecogen</span>)</pre></body></html></div>
<pre><code>## Loading required package: adegenet</code></pre>
<pre><code>## Loading required package: ade4</code></pre>
<pre><code>## Registered S3 method overwritten by 'spdep':
##   method   from
##   plot.mst ape</code></pre>
<pre><code>## 
##    /// adegenet 2.1.3 is loaded ////////////
## 
##    &gt; overview: '?adegenet'
##    &gt; tutorials/doc/questions: 'adegenetWeb()' 
##    &gt; bug reports/feature requests: adegenetIssues()</code></pre>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="no">Frogs.genind</span>@<span class="kw">pop</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.S</a></span>(<span class="no">Frogs.ecogen</span>)$<span class="no">SiteName</span></pre></body></html></div>
<p>For calculating population-level genetic distances, we aggregate the individual-level data to a <code>genpop</code> object with population-level allele frequencies.</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="no">Frogs.genpop</span> <span class="kw">&lt;-</span> <span class="kw pkg">adegenet</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/adegenet/man/genind2genpop.html">genind2genpop</a></span>(<span class="no">Frogs.genind</span>)</pre></body></html></div>
<pre><code>## 
##  Converting data from a genind to a genpop object... 
## 
## ...done.</code></pre>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="no">Frogs.genpop</span></pre></body></html></div>
<pre><code>## /// GENPOP OBJECT /////////
## 
##  // 30 populations; 8 loci; 43 alleles; size: 18.2 Kb
## 
##  // Basic content
##    @tab:  30 x 43 matrix of allele counts
##    @loc.n.all: number of alleles per locus (range: 3-9)
##    @loc.fac: locus factor for the 43 columns of @tab
##    @all.names: list of allele names for each locus
##    @ploidy: ploidy of each individual  (range: 2-2)
##    @type:  codom
##    @call: adegenet::genind2genpop(x = Frogs.genind)
## 
##  // Optional content
##    - empty -</code></pre>
<p>Note: Alternatively, we could directly import the <code>ecopop</code> object into a <code>genpop</code> object (<code>adegenet</code>) with <code><a href="https://rdrr.io/pkg/EcoGenetics/man/ecopop2genpop.html">EcoGenetics::ecopop2genpop(Frogs.ecopop)</a></code>. However, this can create warnings later on when calculating genetic distances.</p>
<p>The object ‘Frogs.genpop’ has 30 rows, each representing a population.</p>
<p>We will also use some functions from the package <code>gstudio</code>, hence we import the individual-level genetic data into <code>gstudio</code>. This should be easy with the function <code><a href="https://rdrr.io/pkg/EcoGenetics/man/ecogen2gstudio.html">EcoGenetics::ecogen2gstudio</a></code>. However, there seems to be an issue. The following chunk contains code adapted from within the <code>ecogen2gstudio</code> function, tweaked to work for our data. (You can view the original function with: <code>findMethods(ecogen2gstudio)</code>.)</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="co">#Frogs.gstudio &lt;- EcoGenetics::ecogen2gstudio(Frogs.ecogen, type="codominant")</span>

  <span class="no">dat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/eco.convert.html">eco.convert</a></span>(<span class="no">Frogs.ecogen</span>@<span class="kw">G</span>, <span class="st">"matrix"</span>, <span class="kw">sep.in</span> <span class="kw">=</span> <span class="st">":"</span>, <span class="kw">sep.out</span> <span class="kw">=</span> <span class="st">":"</span>)
  <span class="no">dat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="no">dat</span>, <span class="kw">stringsAsFactors</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
  <span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(<span class="no">dat</span>)) {
     <span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span>(<span class="no">dat</span>[, <span class="no">i</span>]) <span class="kw">&lt;-</span> <span class="st">"locus"</span>
  }
  <span class="no">dat</span>[<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">dat</span>)] <span class="kw">&lt;-</span> <span class="kw pkg">gstudio</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/gstudio/man/locus.html">locus</a></span>(<span class="fl">NA</span>)</pre></body></html></div>
<pre><code>## Registered S3 method overwritten by 'gstudio':
##   method               from    
##   as.data.frame.genind adegenet</code></pre>
<div class="sourceCode" id="cb29"><html><body><pre class="r">  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">dat</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">Frogs.ecogen</span>@<span class="kw">G</span>)

<span class="no">Frogs.gstudio</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.S</a></span>(<span class="no">Frogs.ecogen</span>), <span class="no">dat</span>)
<span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span>(<span class="no">Frogs.gstudio</span>)</pre></body></html></div>
<pre><code>## # A tibble: 413 x 10
##    SiteName    Pop     A       B       C      D      E      F      G      H     
##    &lt;fct&gt;       &lt;fct&gt;   &lt;locus&gt; &lt;locus&gt; &lt;locu&gt; &lt;locu&gt; &lt;locu&gt; &lt;locu&gt; &lt;locu&gt; &lt;locu&gt;
##  1 AirplaneLa… Airpla… 1:1     1:1     1:1    1:1    1:2    1:1    1:1    4:5   
##  2 AirplaneLa… Airpla… 2:2     1:1            1:1    1:1           2:2          
##  3 AirplaneLa… Airpla… 1:1     1:1     1:1    1:1    3:3    1:1    1:1    3:3   
##  4 AirplaneLa… Airpla… 1:1     1:1            2:2    1:2                        
##  5 AirplaneLa… Airpla… 1:2     1:3     1:1    1:1    1:2    1:1    1:2    4:5   
##  6 AirplaneLa… Airpla… 1:2     1:1     1:1    1:3    1:1    1:1    1:2    4:5   
##  7 AirplaneLa… Airpla… 2:2     1:3     1:1    1:1    3:3    1:1    1:1    2:3   
##  8 AirplaneLa… Airpla… 2:2     1:3     1:1    1:1    3:3    1:1    1:1    2:3   
##  9 AirplaneLa… Airpla… 1:3     1:1     1:1    1:1    1:7    1:1    1:1    3:5   
## 10 AirplaneLa… Airpla… 2:2     1:3     1:1    1:1    3:7    1:1    1:1    3:3   
## # … with 403 more rows</code></pre>
</div>
</div>
<div id="calculate-genetic-distances" class="section level2">
<h2 class="hasAnchor">
<a href="#calculate-genetic-distances" class="anchor"></a>3. Calculate genetic distances</h2>
<p>Here, we’ll calculate a number of different measures of genetic distance, using functions from several packages. Adding the package name to each distance matrix name helps keeping track of methods used. Normally you would not calculate all of them for your own data, and some are redundant, as we will see.</p>
<p>Note: Some functions provide an option <code>linearized = TRUE</code> to linearize distances <code>d</code> by calculating <code>d/(1-d)</code>. This should result in more linear relationships when plotted or correlated against geographic distance.Here we don’t linearize, we can do so later manually.</p>
<div id="a-genetic-distances-calculated-from-genind-object" class="section level3">
<h3 class="hasAnchor">
<a href="#a-genetic-distances-calculated-from-genind-object" class="anchor"></a>a) Genetic distances calculated from genind object</h3>
<p>Pairwise Fst with package <code>hierfstat</code>:</p>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="no">GD.pop.PairwiseFst.hierfstat</span> <span class="kw">&lt;-</span> <span class="kw pkg">hierfstat</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/hierfstat/man/fstat.from.adegenet.html">pairwise.fst</a></span>(<span class="no">Frogs.genind</span>,
                                <span class="kw">pop</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="kw">res.type</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"dist"</span>))</pre></body></html></div>
<p>Proportion of shared alleles with package ‘PopGenReport’:</p>
<div class="sourceCode" id="cb32"><html><body><pre class="r"><span class="no">GD.pop.propShared</span> <span class="kw">&lt;-</span> <span class="kw pkg">PopGenReport</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/PopGenReport/man/pairwise.propShared.html">pairwise.propShared</a></span>(<span class="no">Frogs.genind</span>)</pre></body></html></div>
<pre><code>## Registered S3 method overwritten by 'pegas':
##   method      from
##   print.amova ade4</code></pre>
<pre><code>## Registered S3 method overwritten by 'GGally':
##   method from   
##   +.gg   ggplot2</code></pre>
<pre><code>## Registered S3 methods overwritten by 'genetics':
##   method      from   
##   print.locus gstudio
##   [.haplotype pegas</code></pre>
<p>Several distance matrices with package ‘adegenet’:</p>
<div class="sourceCode" id="cb36"><html><body><pre class="r"><span class="no">GD.pop.Nei</span> <span class="kw">&lt;-</span> <span class="kw pkg">adegenet</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/adegenet/man/dist.genpop.html">dist.genpop</a></span>(<span class="no">Frogs.genpop</span>, <span class="kw">method</span><span class="kw">=</span><span class="fl">1</span>)
<span class="no">GD.pop.Edwards</span> <span class="kw">&lt;-</span> <span class="kw pkg">adegenet</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/adegenet/man/dist.genpop.html">dist.genpop</a></span>(<span class="no">Frogs.genpop</span>, <span class="kw">method</span><span class="kw">=</span><span class="fl">2</span>)
<span class="no">GD.pop.Reynolds</span> <span class="kw">&lt;-</span> <span class="kw pkg">adegenet</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/adegenet/man/dist.genpop.html">dist.genpop</a></span>(<span class="no">Frogs.genpop</span>, <span class="kw">method</span><span class="kw">=</span><span class="fl">3</span>)
<span class="no">GD.pop.Rogers</span> <span class="kw">&lt;-</span> <span class="kw pkg">adegenet</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/adegenet/man/dist.genpop.html">dist.genpop</a></span>(<span class="no">Frogs.genpop</span>, <span class="kw">method</span><span class="kw">=</span><span class="fl">4</span>)
<span class="no">GD.pop.Provesti</span> <span class="kw">&lt;-</span> <span class="kw pkg">adegenet</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/adegenet/man/dist.genpop.html">dist.genpop</a></span>(<span class="no">Frogs.genpop</span>, <span class="kw">method</span><span class="kw">=</span><span class="fl">5</span>)</pre></body></html></div>
<p>Additional distance matrices with package ‘mmod’:</p>
<div class="sourceCode" id="cb37"><html><body><pre class="r"><span class="no">GD.pop.Joost</span> <span class="kw">&lt;-</span> <span class="kw pkg">mmod</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/mmod/man/pairwise_D.html">pairwise_D</a></span>(<span class="no">Frogs.genind</span>, <span class="kw">linearized</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="no">GD.pop.Hedrick</span> <span class="kw">&lt;-</span> <span class="kw pkg">mmod</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/mmod/man/pairwise_Gst_Hedrick.html">pairwise_Gst_Hedrick</a></span>(<span class="no">Frogs.genind</span>, <span class="kw">linearized</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="no">GD.pop.NeiGst</span> <span class="kw">&lt;-</span> <span class="kw pkg">mmod</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/mmod/man/pairwise_Gst_Nei.html">pairwise_Gst_Nei</a></span>(<span class="no">Frogs.genind</span>, <span class="kw">linearized</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
</div>
<div id="b-more-distance-matrices-with-gstudio" class="section level3">
<h3 class="hasAnchor">
<a href="#b-more-distance-matrices-with-gstudio" class="anchor"></a>b) More distance matrices with ‘gstudio’</h3>
<div class="sourceCode" id="cb38"><html><body><pre class="r"><span class="no">GD.pop.Euclidean.gstudio</span> <span class="kw">&lt;-</span><span class="kw pkg">gstudio</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/gstudio/man/genetic_distance.html">genetic_distance</a></span>(<span class="no">Frogs.gstudio</span>, <span class="kw">mode</span> <span class="kw">=</span> <span class="st">"Euclidean"</span>, <span class="kw">stratum</span><span class="kw">=</span><span class="st">"SiteName"</span>)</pre></body></html></div>
<pre><code>## Multilous estimates of Euclidean distance are assumed to be additive.</code></pre>
<div class="sourceCode" id="cb40"><html><body><pre class="r"><span class="no">GD.pop.cGD.gstudio</span> <span class="kw">&lt;-</span><span class="kw pkg">gstudio</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/gstudio/man/genetic_distance.html">genetic_distance</a></span>(<span class="no">Frogs.gstudio</span>, <span class="kw">mode</span> <span class="kw">=</span> <span class="st">"cGD"</span>, <span class="kw">stratum</span><span class="kw">=</span><span class="st">"SiteName"</span>)
<span class="no">GD.pop.Nei.gstudio</span> <span class="kw">&lt;-</span><span class="kw pkg">gstudio</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/gstudio/man/genetic_distance.html">genetic_distance</a></span>(<span class="no">Frogs.gstudio</span>, <span class="kw">mode</span> <span class="kw">=</span> <span class="st">"Nei"</span>, <span class="kw">stratum</span><span class="kw">=</span><span class="st">"SiteName"</span>)
<span class="no">GD.pop.Dps.gstudio</span> <span class="kw">&lt;-</span><span class="kw pkg">gstudio</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/gstudio/man/genetic_distance.html">genetic_distance</a></span>(<span class="no">Frogs.gstudio</span>, <span class="kw">mode</span> <span class="kw">=</span> <span class="st">"Dps"</span>, <span class="kw">stratum</span><span class="kw">=</span><span class="st">"SiteName"</span>)</pre></body></html></div>
<pre><code>## Bray distance will be assumed to be entirely additive across loci.</code></pre>
<div class="sourceCode" id="cb42"><html><body><pre class="r"><span class="no">GD.pop.Jaccard.gstudio</span> <span class="kw">&lt;-</span><span class="kw pkg">gstudio</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/gstudio/man/genetic_distance.html">genetic_distance</a></span>(<span class="no">Frogs.gstudio</span>, <span class="kw">mode</span> <span class="kw">=</span> <span class="st">"Jaccard"</span>, <span class="kw">stratum</span><span class="kw">=</span><span class="st">"SiteName"</span>)</pre></body></html></div>
<pre><code>## Jaccard distance will be assumed to be entirely additive across loci.</code></pre>
</div>
<div id="c-assemble-distance-matrices" class="section level3">
<h3 class="hasAnchor">
<a href="#c-assemble-distance-matrices" class="anchor"></a>c) Assemble distance matrices</h3>
<p>We’ll store the population-level genetic distances in a list ‘GD.pop’.</p>
<p>Note: a few measures return similarities (scaled between 0 and 1) instead of distances. For instance, ‘proporition of shared alleles’ is 1 if the alleles are identical, and zero of no alleles are shared. We convert these values to distances by subtracting them from 1.</p>
<div class="sourceCode" id="cb44"><html><body><pre class="r"><span class="no">GD.pop</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">pairwiseFst.hierfstat</span> <span class="kw">=</span> <span class="no">GD.pop.PairwiseFst.hierfstat</span>,
               <span class="kw">propShared.PopGenReport</span> <span class="kw">=</span> <span class="fl">1</span> - <span class="no">GD.pop.propShared</span>,
               <span class="kw">Nei.adegenet</span> <span class="kw">=</span> <span class="no">GD.pop.Nei</span>,
               <span class="kw">Edwards.adegenet</span> <span class="kw">=</span> <span class="no">GD.pop.Edwards</span>,
               <span class="kw">Reynolds.adegenet</span> <span class="kw">=</span> <span class="no">GD.pop.Reynolds</span>,
               <span class="kw">Rogers.adegenet</span> <span class="kw">=</span> <span class="no">GD.pop.Rogers</span>,
               <span class="kw">Provesti.adegenet</span> <span class="kw">=</span> <span class="no">GD.pop.Provesti</span>,
               <span class="kw">Joost.mmod</span> <span class="kw">=</span> <span class="no">GD.pop.Joost</span>,
               <span class="kw">Hedrick.mmod</span> <span class="kw">=</span> <span class="no">GD.pop.Hedrick</span>,
               <span class="kw">Nei.mmod</span> <span class="kw">=</span> <span class="no">GD.pop.NeiGst</span>,
               <span class="kw">Euclidean.gstudio</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">as.dist</a></span>(<span class="no">GD.pop.Euclidean.gstudio</span>),
               <span class="kw">cGD.gstudio</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">as.dist</a></span>(<span class="no">GD.pop.cGD.gstudio</span>),
               <span class="kw">Nei.gstudio</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">as.dist</a></span>(<span class="no">GD.pop.Nei.gstudio</span>),
               <span class="kw">Dps.gstudio</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">as.dist</a></span>(<span class="fl">1</span> - <span class="no">GD.pop.Dps.gstudio</span>),
               <span class="kw">Jaccard.gstudio</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">as.dist</a></span>(<span class="fl">1</span> - <span class="no">GD.pop.Jaccard.gstudio</span>))
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">GD.pop</span>, <span class="kw">function</span>(<span class="no">ls</span>) <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span>(<span class="no">ls</span>))),<span class="fl">2</span>)[,<span class="fl">1</span>:<span class="fl">2</span>]</pre></body></html></div>
<pre><code>##                         pairwiseFst.hierfstat propShared.PopGenReport
## pairwiseFst.hierfstat                    1.00                    0.77
## propShared.PopGenReport                  0.77                    1.00
## Nei.adegenet                             0.84                    0.96
## Edwards.adegenet                         0.83                    0.93
## Reynolds.adegenet                        0.92                    0.82
## Rogers.adegenet                          0.80                    0.99
## Provesti.adegenet                        0.77                    1.00
## Joost.mmod                               0.87                    0.95
## Hedrick.mmod                             0.93                    0.88
## Nei.mmod                                 0.93                    0.77
## Euclidean.gstudio                        0.89                    0.95
## cGD.gstudio                              0.50                    0.62
## Nei.gstudio                              0.84                    0.96
## Dps.gstudio                              0.70                    0.90
## Jaccard.gstudio                          0.70                    0.90</code></pre>
<p>Consider the correlations printed above (only the first two columns of the correlation matrix are shown).</p>
<ul>
<li>Correlations are high in general, except for conditional genetic distance (cGD) (see Week 13).</li>
<li>There are some duplicate measures (with correlation = 1).</li>
</ul>
<p>Note: the following functions calculate distance matrices at the individual level:</p>
<ul>
<li>PopGenReport::gd.smouse()</li>
<li>adegenet::propShared()</li>
<li>gstudio::genetic_distance(mode = “AMOVA”)</li>
</ul>
</div>
<div id="d-export-genetic-distance-matrices" class="section level3">
<h3 class="hasAnchor">
<a href="#d-export-genetic-distance-matrices" class="anchor"></a>d) Export genetic distance matrices</h3>
<p>Optional: You can use <code>save</code> to save an R object to your file system, and <code>load</code> to read it in again. Note: the default setting is that <code>save</code> will overwrite existing files with the same name.</p>
<p>The code is commented out with <code>#</code>. To run it, remove the <code>#</code>. The first part creates a folder <code>output</code> in your project folder if it does not yet exist. The function <code>save</code> writes the list <code>GD.pop</code> into a file “GD.pop.RData”, and the function <code>load</code> imports it again.</p>
<div class="sourceCode" id="cb46"><html><body><pre class="r">#require(here)
#if(!dir.exists(paste0(here::here(),"/output"))) dir.create(paste0(here::here(),"/output"))

#save(GD.pop, file = paste0(here::here(),"/output/GD.pop.RData"))
#load(paste0(here::here(),"/output/GD.pop.RData"))</pre></body></html></div>
</div>
</div>
<div id="perform-a-mantel-test-to-test-for-ibd" class="section level2">
<h2 class="hasAnchor">
<a href="#perform-a-mantel-test-to-test-for-ibd" class="anchor"></a>4. Perform a Mantel test to test for IBD</h2>
<p>First, we calculate geographic (Euclidean) distances <code>Dgeo</code> with the <code>dist</code> function, using the spatial coordinates that we imported from ralu.site. These are UTM coordinates and thus metric.</p>
<div class="sourceCode" id="cb47"><html><body><pre class="r"><span class="no">Dgeo</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.XY</a></span>(<span class="no">Frogs.ecopop</span>)[,<span class="fl">1</span>:<span class="fl">2</span>])</pre></body></html></div>
<div id="a-visually-check-linearity" class="section level3">
<h3 class="hasAnchor">
<a href="#a-visually-check-linearity" class="anchor"></a>a) Visually check linearity</h3>
<p>Before we quantify the linear relationship between genetic and geographic distances, let’s check visually whether the relationship is indeed linear. To start, we will define genetic distance <code>Dgen</code> based on proportion of shared alleles.</p>
<div class="sourceCode" id="cb48"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mar</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">0</span>,<span class="fl">0</span>))
<span class="no">Dgen</span> <span class="kw">&lt;-</span> <span class="no">GD.pop</span>$<span class="no">propShared.PopGenReport</span>
<span class="no">dens</span> <span class="kw">&lt;-</span> <span class="kw pkg">MASS</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/kde2d.html">kde2d</a></span>(<span class="no">Dgeo</span>, <span class="no">Dgen</span>, <span class="kw">n</span><span class="kw">=</span><span class="fl">300</span>)
<span class="no">myPal</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"white"</span>,<span class="st">"blue"</span>,<span class="st">"gold"</span>,<span class="st">"orange"</span>,<span class="st">"red"</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">Dgeo</span>, <span class="no">Dgen</span>, <span class="kw">pch</span><span class="kw">=</span><span class="fl">20</span>, <span class="kw">cex</span><span class="kw">=</span><span class="fl">0.5</span>,
    <span class="kw">xlab</span><span class="kw">=</span><span class="st">"Geographic Distance"</span>, <span class="kw">ylab</span><span class="kw">=</span><span class="st">"Genetic Distance"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/image.html">image</a></span>(<span class="no">dens</span>, <span class="kw">col</span><span class="kw">=</span><span class="fu">transp</span>(<span class="fu">myPal</span>(<span class="fl">300</span>), <span class="fl">0.7</span>), <span class="kw">add</span><span class="kw">=</span><span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">Dgen</span> ~ <span class="no">Dgeo</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/scatter.smooth.html">loess.smooth</a></span>(<span class="no">Dgeo</span>, <span class="no">Dgen</span>), <span class="kw">col</span><span class="kw">=</span><span class="st">"red"</span>)</pre></body></html></div>
<p><img src="Week5_vignette_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<p>There is clearly an increase of genetic distance with geographic distance. However, the red line, which is a smoothed local mean, indicates that the relationship is not linear.</p>
<p>Let’s take the natural logarithm of geographic distance:</p>
<div class="sourceCode" id="cb49"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mar</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">0</span>,<span class="fl">0</span>))
<span class="no">dens</span> <span class="kw">&lt;-</span> <span class="kw pkg">MASS</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/kde2d.html">kde2d</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">Dgeo</span>), <span class="no">Dgen</span>, <span class="kw">n</span><span class="kw">=</span><span class="fl">300</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">Dgeo</span>), <span class="no">Dgen</span>, <span class="kw">pch</span><span class="kw">=</span><span class="fl">20</span>, <span class="kw">cex</span><span class="kw">=</span><span class="fl">0.5</span>,
    <span class="kw">xlab</span><span class="kw">=</span><span class="st">"Geographic Distance"</span>, <span class="kw">ylab</span><span class="kw">=</span><span class="st">"Genetic Distance"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/image.html">image</a></span>(<span class="no">dens</span>, <span class="kw">col</span><span class="kw">=</span><span class="fu">transp</span>(<span class="fu">myPal</span>(<span class="fl">300</span>), <span class="fl">0.7</span>), <span class="kw">add</span><span class="kw">=</span><span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">Dgen</span> ~ <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">Dgeo</span>)))
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/scatter.smooth.html">loess.smooth</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">Dgeo</span>), <span class="no">Dgen</span>), <span class="kw">col</span><span class="kw">=</span><span class="st">"red"</span>)</pre></body></html></div>
<p><img src="Week5_vignette_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
<p><strong>Questions:</strong></p>
<ul>
<li>Is the relationship between Dgen and Dgeo more linear than before the transformation?</li>
<li>What happened to the spread of points along the x axis (geographic distance)?</li>
<li>What do the units of the x-axis represent, after the transformation?</li>
</ul>
</div>
<div id="b-perform-mantel-test" class="section level3">
<h3 class="hasAnchor">
<a href="#b-perform-mantel-test" class="anchor"></a>b) Perform Mantel test</h3>
<p>Next, we perform a Mantel test with the function <code>mantel</code> from the <code>vegan</code> package.</p>
<div class="sourceCode" id="cb50"><html><body><pre class="r"><span class="no">IBD</span> <span class="kw">&lt;-</span> <span class="kw pkg">vegan</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/mantel.html">mantel</a></span>(<span class="no">Dgen</span>,<span class="no">Dgeo</span>, <span class="kw">method</span><span class="kw">=</span><span class="st">"pearson"</span>)
<span class="no">IBD</span></pre></body></html></div>
<pre><code>## 
## Mantel statistic based on Pearson's product-moment correlation 
## 
## Call:
## vegan::mantel(xdis = Dgen, ydis = Dgeo, method = "pearson") 
## 
## Mantel statistic r: 0.6211 
##       Significance: 0.001 
## 
## Upper quantiles of permutations (null model):
##    90%    95%  97.5%    99% 
## 0.0817 0.1069 0.1304 0.1530 
## Permutation: free
## Number of permutations: 999</code></pre>
<p>What happens if we take the log of geographic distance, which we saw above helps linearize the relationship for these data?</p>
<div class="sourceCode" id="cb52"><html><body><pre class="r"><span class="no">IBD</span> <span class="kw">&lt;-</span> <span class="kw pkg">vegan</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/mantel.html">mantel</a></span>(<span class="no">Dgen</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">Dgeo</span>), <span class="kw">method</span><span class="kw">=</span><span class="st">"pearson"</span>)
<span class="no">IBD</span></pre></body></html></div>
<pre><code>## 
## Mantel statistic based on Pearson's product-moment correlation 
## 
## Call:
## vegan::mantel(xdis = Dgen, ydis = log(Dgeo), method = "pearson") 
## 
## Mantel statistic r: 0.6839 
##       Significance: 0.001 
## 
## Upper quantiles of permutations (null model):
##    90%    95%  97.5%    99% 
## 0.0700 0.0973 0.1196 0.1427 
## Permutation: free
## Number of permutations: 999</code></pre>
<p>The statistical significance (p-value) didn’t really change, but the strength of the Mantel correlation increased from r = 0.62 to r = 0.68.</p>
<p>Instead of transforming variables, we could use Spearman rank correlation to quantify the strength of the association. Rank correlations can be used to quantify and test the strength of curvilinear relationships.</p>
<div class="sourceCode" id="cb54"><html><body><pre class="r"><span class="no">IBD</span> <span class="kw">&lt;-</span> <span class="kw pkg">vegan</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/mantel.html">mantel</a></span>(<span class="no">Dgen</span>,<span class="no">Dgeo</span>, <span class="kw">method</span><span class="kw">=</span><span class="st">"spearman"</span>)
<span class="no">IBD</span></pre></body></html></div>
<pre><code>## 
## Mantel statistic based on Spearman's rank correlation rho 
## 
## Call:
## vegan::mantel(xdis = Dgen, ydis = Dgeo, method = "spearman") 
## 
## Mantel statistic r: 0.6512 
##       Significance: 0.001 
## 
## Upper quantiles of permutations (null model):
##    90%    95%  97.5%    99% 
## 0.0715 0.0970 0.1190 0.1527 
## Permutation: free
## Number of permutations: 999</code></pre>
<p>For this measure of genetic diversity, the Mantel correlation was significant, quite strong, and the relationship not linear, hence the transformed data or the rank correlation performed better. What about the other measures?</p>
<p>Here we use <code>lapply</code> to apply the function <code>mantel</code> to each genetic distance matrix in <code>GD.pop</code>. Then we use <code>sapply</code> to extract two values for each distance matrix: <code>statistic</code> is the Mantel r statistic (here: Pearson linear correlation), and <code>signif</code> is the p-value. We can find these names with the function <code>attributes</code> (see above).</p>
<div class="sourceCode" id="cb56"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/attributes.html">attributes</a></span>(<span class="no">IBD</span>)</pre></body></html></div>
<pre><code>## $names
## [1] "call"         "method"       "statistic"    "signif"       "perm"        
## [6] "permutations" "control"     
## 
## $class
## [1] "mantel"</code></pre>
<div class="sourceCode" id="cb58"><html><body><pre class="r"><span class="no">Mantel.test</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">GD.pop</span>, <span class="kw">function</span>(<span class="no">x</span>) <span class="kw pkg">vegan</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/mantel.html">mantel</a></span>(<span class="no">x</span>,<span class="no">Dgeo</span>, <span class="kw">method</span><span class="kw">=</span><span class="st">"pearson"</span>))
<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">Mantel.r</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">Mantel.test</span>, <span class="kw">function</span>(<span class="no">x</span>) <span class="no">x</span>$<span class="no">statistic</span>),
           <span class="kw">p.value</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">Mantel.test</span>, <span class="kw">function</span>(<span class="no">x</span>) <span class="no">x</span>$<span class="no">signif</span>))</pre></body></html></div>
<pre><code>##                          Mantel.r p.value
## pairwiseFst.hierfstat   0.6303304   0.001
## propShared.PopGenReport 0.6211335   0.001
## Nei.adegenet            0.6316224   0.001
## Edwards.adegenet        0.6639963   0.001
## Reynolds.adegenet       0.6162305   0.001
## Rogers.adegenet         0.6188092   0.001
## Provesti.adegenet       0.6211335   0.001
## Joost.mmod              0.6556870   0.001
## Hedrick.mmod            0.6520614   0.001
## Nei.mmod                0.6147866   0.001
## Euclidean.gstudio       0.6591863   0.001
## cGD.gstudio             0.5667087   0.001
## Nei.gstudio             0.6317948   0.001
## Dps.gstudio             0.5371591   0.001
## Jaccard.gstudio         0.5357096   0.001</code></pre>
<p>The nature of the result did not depend on the measure of genetic diversity used. Let’s repeat the analysis with log(Dgeo).</p>
<div class="sourceCode" id="cb60"><html><body><pre class="r"><span class="no">Mantel.test</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">GD.pop</span>, <span class="kw">function</span>(<span class="no">x</span>) <span class="kw pkg">ade4</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/ade4/man/mantel.randtest.html">mantel.randtest</a></span>(<span class="no">x</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">Dgeo</span>)))
<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">Mantel.r</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">Mantel.test</span>, <span class="kw">function</span>(<span class="no">x</span>) <span class="no">x</span>$<span class="no">obs</span>),
           <span class="kw">p.value</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">Mantel.test</span>, <span class="kw">function</span>(<span class="no">x</span>) <span class="no">x</span>$<span class="no">pvalue</span>))</pre></body></html></div>
<pre><code>##                          Mantel.r p.value
## pairwiseFst.hierfstat   0.6261978   0.001
## propShared.PopGenReport 0.6839092   0.001
## Nei.adegenet            0.6547320   0.001
## Edwards.adegenet        0.7122499   0.001
## Reynolds.adegenet       0.6437788   0.001
## Rogers.adegenet         0.6718605   0.001
## Provesti.adegenet       0.6839092   0.001
## Joost.mmod              0.6748485   0.001
## Hedrick.mmod            0.6673508   0.001
## Nei.mmod                0.6034555   0.001
## Euclidean.gstudio       0.6967457   0.001
## cGD.gstudio             0.6008983   0.001
## Nei.gstudio             0.6548413   0.001
## Dps.gstudio             0.5911350   0.001
## Jaccard.gstudio         0.5880305   0.001</code></pre>
<p><strong>Questions:</strong> - Did the transformation lead to higher Mantel correlations for all measures of genetic distance used here? - Why was it higher?</p>
</div>
</div>
<div id="create-mantel-correlogram-for-genetic-data" class="section level2">
<h2 class="hasAnchor">
<a href="#create-mantel-correlogram-for-genetic-data" class="anchor"></a>5. Create Mantel correlogram for genetic data</h2>
<p>Let’s look at the relationship between genetic distance and geographic distance in a different way, with a Mantel correlogram. Note that this method does not make the assumption of linearity.</p>
<div id="a-create-a-first-mantel-correlogram" class="section level3">
<h3 class="hasAnchor">
<a href="#a-create-a-first-mantel-correlogram" class="anchor"></a>a) Create a first Mantel correlogram</h3>
<p>Here, we’ll create a population-level Mantel correlogram with the proportion of shared alleles.</p>
<p>Note: The function <code>eco.cormantel</code> has an option <code>latlon=TRUE</code> that takes care of the distance calculation from lat-lon coordinates. To use this option, the coordinates must be in a matrix or data frame with the longitude in the first column and the latitude in the second. Here, we can set we can set <code>latlon=FALSE</code> because the spatial coordinates are in UTM projection.</p>
<p>The biological hypothesis of isolation-by-distance postulates that genetic distance increases with geographic distance. Hence it makes sense to use a one-sided alternative. Somewhat counter-intutitively, we use ‘alternative=“less”’ to test for positive spatial autocorrelation.</p>
<div class="sourceCode" id="cb62"><html><body><pre class="r"><span class="no">corm</span> <span class="kw">&lt;-</span> <span class="kw pkg">EcoGenetics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/eco.cormantel.html">eco.cormantel</a></span>(<span class="kw">M</span> <span class="kw">=</span> <span class="no">GD.pop</span>$<span class="no">propShared.PopGenReport</span>,
        <span class="kw">XY</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.XY</a></span>(<span class="no">Frogs.ecopop</span>)[,<span class="fl">1</span>:<span class="fl">2</span>],  <span class="kw">nsim</span> <span class="kw">=</span> <span class="fl">199</span>, <span class="kw">latlon</span><span class="kw">=</span><span class="fl">FALSE</span>,
        <span class="kw">alternative</span><span class="kw">=</span><span class="st">"less"</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"pearson"</span>)</pre></body></html></div>
<pre><code>## 
 interval 0 / 10 completed
 interval 1 / 10 completed
 interval 2 / 10 completed
 interval 3 / 10 completed
 interval 4 / 10 completed
 interval 5 / 10 completed
 interval 6 / 10 completed
 interval 7 / 10 completed
 interval 8 / 10 completed
 interval 9 / 10 completed
 interval 10 / 10 completed</code></pre>
<div class="sourceCode" id="cb64"><html><body><pre class="r"><span class="no">corm</span></pre></body></html></div>
<pre><code>## 
##  ############################ 
##    Mantel statistic 
##  ############################ 
## 
##  &gt; Correlation coefficient used --&gt;  Pearson 
##   &gt; Number of simulations --&gt;  199 
##   &gt; Random test --&gt;  permutation 
##   &gt; P-adjust method --&gt;  holm -sequential: TRUE 
## 
##   &gt;  ecoslot.OUT(x): results --&gt;  
## 
## [[1]]
##                           d.mean     obs     exp p.val cardinal
## d= 0 - 1055.243          697.776  0.4815  0.0013 0.005       45
## d= 1055.243 - 2110.485  1583.490  0.2708  0.0026 0.010       67
## d= 2110.485 - 3165.728  2622.371  0.2043  0.0111 0.015       64
## d= 3165.728 - 4220.97   3710.591 -0.1302  0.0000 0.990       64
## d= 4220.97 - 5276.213   4716.029 -0.1719  0.0063 1.000       54
## d= 5276.213 - 6331.455  5824.450 -0.2021 -0.0037 1.000       46
## d= 6331.455 - 7386.698  6856.457 -0.1496 -0.0017 1.000       27
## d= 7386.698 - 8441.941  7883.679 -0.2297 -0.0040 1.000       33
## d= 8441.941 - 9497.183  8882.536 -0.1909 -0.0064 1.000       25
## d= 9497.183 - 10552.426 9847.000 -0.0807 -0.0041 1.000        9
## 
## 
##  Results table(s) in ecoslot.OUT(x) 
## --------------------------------------------------------------------------
##  Access to slots: &lt;ecoslot.&gt; + &lt;name of the slot&gt; + &lt;(name of the object)&gt; 
##  See: help("EcoGenetics accessors")</code></pre>
<p>The table shows:</p>
<ul>
<li>Breaks of distance lag ‘d’: here in meters (default for lag definition: Sturges rule)</li>
<li>Mean distance ‘d.mean’: mean distance of pairs in each lag.</li>
<li>obs: observed value of the statistic</li>
<li>Expected value ‘exp’: expected if there is no autocorrelation.</li>
<li>P-value ‘p.val’: default uses a two-sided permutation test with sequential Holm-Bonferroni adjustement of p-values.</li>
<li>Number of pairs ‘cardinal’: number of unique pairs per lag.</li>
</ul>
<p>The result <code>corm</code> is an object of class <code>eco.correlog</code> (package: EcoGenetics). A safe way to access thet table is <code><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.OUT(corm)</a></code>.</p>
<p>Let’s plot the correlogram:</p>
<div class="sourceCode" id="cb66"><html><body><pre class="r"><span class="kw pkg">EcoGenetics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/eco.plotCorrelog.html">eco.plotCorrelog</a></span>(<span class="no">corm</span>)</pre></body></html></div>
<p>You can hover over individual points of the correlogram to see the test statistic and mean distance.</p>
</div>
<div id="b-vary-distance-class-definition" class="section level3">
<h3 class="hasAnchor">
<a href="#b-vary-distance-class-definition" class="anchor"></a>b) Vary distance class definition</h3>
<p>Under IBD, at least the first distance lag should show positive spatial autocorrelation. Here, it is the first two classes, as indicated by the red symbols.</p>
<p>To what degree does this result depend on the following:</p>
<ul>
<li>The distance lag definition?</li>
<li>The measure of genetic distance?</li>
<li>Non-linear relationship between genetic and geographic distances?</li>
</ul>
<p>There are several options of the <code>eco.cormantel</code> function to modify the definition of distance classes:</p>
<ul>
<li>
<code>int</code>: distance interval in the units of XY</li>
<li>
<code>smin</code>: minimum class distance in the units of XY</li>
<li>
<code>smax</code>: maximum class distance in the units of XY</li>
<li>
<code>nclass</code>: number of classes</li>
<li>
<code>seqvec</code>: vector with breaks in the unites of XY</li>
<li>
<code>size</code>: number of individuals per class</li>
<li>
<code>bin</code>: rule for constructing intervals if no other parameters provided (default: Sturge’s rule)</li>
</ul>
<p>The easiest ones to modify are either <code>nclass</code> or <code>size</code>. Here we use <code>size</code> to specify that there should be at least 50 or 100 pairs in each distance class. (Note: for a reliable analysis, this should be 100 or more).</p>
<div class="sourceCode" id="cb67"><html><body><pre class="r"><span class="no">corm.50</span> <span class="kw">&lt;-</span> <span class="kw pkg">EcoGenetics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/eco.cormantel.html">eco.cormantel</a></span>(<span class="kw">M</span> <span class="kw">=</span> <span class="no">GD.pop</span>$<span class="no">propShared.PopGenReport</span>,
           <span class="kw">XY</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.XY</a></span>(<span class="no">Frogs.ecopop</span>)[,<span class="fl">1</span>:<span class="fl">2</span>],  <span class="kw">nsim</span> <span class="kw">=</span> <span class="fl">199</span>, <span class="kw">latlon</span><span class="kw">=</span><span class="fl">FALSE</span>,
           <span class="kw">alternative</span><span class="kw">=</span><span class="st">"less"</span>, <span class="kw">size</span><span class="kw">=</span><span class="fl">50</span>)</pre></body></html></div>
<pre><code>## 
 interval 0 / 8 completed
 interval 1 / 8 completed
 interval 2 / 8 completed
 interval 3 / 8 completed
 interval 4 / 8 completed
 interval 5 / 8 completed
 interval 6 / 8 completed
 interval 7 / 8 completed
 interval 8 / 8 completed</code></pre>
<div class="sourceCode" id="cb69"><html><body><pre class="r"><span class="kw pkg">EcoGenetics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.OUT</a></span>(<span class="no">corm.50</span>)</pre></body></html></div>
<pre><code>## [[1]]
##                          d.mean     obs     exp p.val cardinal
## d= 0 - 1152.337         739.966  0.4872 -0.0045 0.005       50
## d= 1152.337 - 1821.843 1536.052  0.2256 -0.0015 0.010       50
## d= 1821.843 - 2769.341 2286.134  0.2307  0.0079 0.015       50
## d= 2769.341 - 3526.318 3169.188  0.0411  0.0001 0.235       50
## d= 3526.318 - 4408.262 3992.072 -0.1714 -0.0034 1.000       50
## d= 4408.262 - 5339.102 4863.176 -0.1579 -0.0015 1.000       50
## d= 5339.102 - 6668.986 6011.873 -0.2404  0.0025 1.000       50
## d= 6668.986 - 8434.883 7615.126 -0.2429  0.0005 1.000       50</code></pre>
<div class="sourceCode" id="cb71"><html><body><pre class="r"><span class="no">corm.100</span> <span class="kw">&lt;-</span> <span class="kw pkg">EcoGenetics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/eco.cormantel.html">eco.cormantel</a></span>(<span class="kw">M</span> <span class="kw">=</span> <span class="no">GD.pop</span>$<span class="no">propShared.PopGenReport</span>,
           <span class="kw">XY</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.XY</a></span>(<span class="no">Frogs.ecopop</span>)[,<span class="fl">1</span>:<span class="fl">2</span>],  <span class="kw">nsim</span> <span class="kw">=</span> <span class="fl">199</span>, <span class="kw">latlon</span><span class="kw">=</span><span class="fl">FALSE</span>,
           <span class="kw">alternative</span><span class="kw">=</span><span class="st">"less"</span>, <span class="kw">size</span><span class="kw">=</span><span class="fl">100</span>)</pre></body></html></div>
<pre><code>## 
 interval 0 / 4 completed
 interval 1 / 4 completed
 interval 2 / 4 completed
 interval 3 / 4 completed
 interval 4 / 4 completed</code></pre>
<div class="sourceCode" id="cb73"><html><body><pre class="r"><span class="kw pkg">EcoGenetics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.OUT</a></span>(<span class="no">corm.100</span>)</pre></body></html></div>
<pre><code>## [[1]]
##                          d.mean     obs     exp p.val cardinal
## d= 0 - 1821.843        1138.009  0.5403  0.0006 0.005      100
## d= 1821.843 - 3526.318 2727.661  0.2060 -0.0009 0.010      100
## d= 3526.318 - 5339.102 4427.624 -0.2496  0.0114 1.000      100
## d= 5339.102 - 8434.883 6813.499 -0.3664  0.0090 1.000      100</code></pre>
<div class="sourceCode" id="cb75"><html><body><pre class="r"><span class="kw pkg">EcoGenetics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/eco.plotCorrelog.html">eco.plotCorrelog</a></span>(<span class="no">corm.50</span>)
<span class="kw pkg">EcoGenetics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/eco.plotCorrelog.html">eco.plotCorrelog</a></span>(<span class="no">corm.100</span>)</pre></body></html></div>
<p>Let’s compare the observed Mantel r statistic, p-value, number of pairs in the first distance class and their mean distance, as well as the definition of the first lag interval. We can get all of this by extracting the first line from each object.</p>
<p>The lag intervals are stored only in the row names, and we need to extract those separately and add them as a colum.</p>
<div class="sourceCode" id="cb76"><html><body><pre class="r"><span class="no">Lag1.def</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="kw">Sturge</span> <span class="kw">=</span> <span class="kw pkg">EcoGenetics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.OUT</a></span>(<span class="no">corm</span>)<span class="kw">[[</span><span class="fl">1</span>]][<span class="fl">1</span>,],
      <span class="kw">size.50</span> <span class="kw">=</span> <span class="kw pkg">EcoGenetics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.OUT</a></span>(<span class="no">corm.50</span>)<span class="kw">[[</span><span class="fl">1</span>]][<span class="fl">1</span>,],
      <span class="kw">size.100</span> <span class="kw">=</span> <span class="kw pkg">EcoGenetics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.OUT</a></span>(<span class="no">corm.100</span>)<span class="kw">[[</span><span class="fl">1</span>]][<span class="fl">1</span>,]))
<span class="no">Lag1.def</span>$<span class="no">bin</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span>(<span class="kw pkg">EcoGenetics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.OUT</a></span>(<span class="no">corm</span>)<span class="kw">[[</span><span class="fl">1</span>]])[<span class="fl">1</span>],
              <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span>(<span class="kw pkg">EcoGenetics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.OUT</a></span>(<span class="no">corm.50</span>)<span class="kw">[[</span><span class="fl">1</span>]])[<span class="fl">1</span>],
              <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span>(<span class="kw pkg">EcoGenetics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.OUT</a></span>(<span class="no">corm.100</span>)<span class="kw">[[</span><span class="fl">1</span>]])[<span class="fl">1</span>])
<span class="no">Lag1.def</span></pre></body></html></div>
<pre><code>##            d.mean    obs     exp p.val cardinal             bin
## Sturge    697.776 0.4815  0.0013 0.005       45 d= 0 - 1055.243
## size.50   739.966 0.4872 -0.0045 0.005       50 d= 0 - 1152.337
## size.100 1138.009 0.5403  0.0006 0.005      100 d= 0 - 1821.843</code></pre>
<ul>
<li>All three distance class definitions (Sturge’s rule, size = 50, size = 100) resulted in statistically significant p-values.</li>
<li>The Mantel correlation in the first distance lag was strongest for size.100.</li>
<li>For the first distance class, Sturge’s rule resulted in 45 pairs and a mean distance similar to size.50 (for this specific dataset).</li>
</ul>
<p>Overall, Sturge’s rule to define distance classes seems to be a good compromise. What is the trade-off, i.e., what happens if distance lags are defined too narrowly or too widely?</p>
<p>It can be really helpful to plot the distribution of distances among the pairs and compare it to the distance intervals:</p>
<div class="sourceCode" id="cb78"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mfrow</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>,<span class="fl">1</span>))

<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(<span class="no">Dgeo</span>, <span class="kw">nclass</span><span class="kw">=</span><span class="fl">50</span>, <span class="kw">main</span><span class="kw">=</span><span class="st">"Sturge's rule"</span>, <span class="kw">axes</span><span class="kw">=</span><span class="no">F</span>, <span class="kw">xlab</span><span class="kw">=</span><span class="st">""</span>, <span class="kw">ylab</span><span class="kw">=</span><span class="st">""</span>)
<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="kw pkg">EcoGenetics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.BREAKS</a></span>(<span class="no">corm</span>))){
  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="kw pkg">EcoGenetics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.BREAKS</a></span>(<span class="no">corm</span>)[<span class="no">i</span>], <span class="fl">2</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">50</span>), <span class="kw">col</span><span class="kw">=</span><span class="st">"blue"</span>)}

<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(<span class="no">Dgeo</span>, <span class="kw">nclass</span><span class="kw">=</span><span class="fl">50</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="st">"50 pairs per lag"</span>, <span class="kw">axes</span><span class="kw">=</span><span class="no">F</span>)
<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="kw pkg">EcoGenetics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.BREAKS</a></span>(<span class="no">corm.50</span>))){
  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="kw pkg">EcoGenetics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.BREAKS</a></span>(<span class="no">corm.50</span>)[<span class="no">i</span>], <span class="fl">2</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">50</span>), <span class="kw">col</span><span class="kw">=</span><span class="st">"blue"</span>)}

<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(<span class="no">Dgeo</span>, <span class="kw">nclass</span><span class="kw">=</span><span class="fl">50</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="st">"100 pairs per lag"</span>, <span class="kw">axes</span><span class="kw">=</span><span class="no">F</span>)
<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="kw pkg">EcoGenetics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.BREAKS</a></span>(<span class="no">corm.100</span>))){
  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="kw pkg">EcoGenetics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.BREAKS</a></span>(<span class="no">corm.100</span>)[<span class="no">i</span>], <span class="fl">2</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">50</span>), <span class="kw">col</span><span class="kw">=</span><span class="st">"blue"</span>)}</pre></body></html></div>
<p><img src="Week5_vignette_files/figure-html/unnamed-chunk-33-1.png" width="768"></p>
<p><strong>Question:</strong> Compare what happens at larger distances. Do you think Sturge’s rule does a good job for these as well?</p>
<p>Unlike a Mantel test, where all pairs are considered, in geostatistics we typically interpret only values for distances up to a certain threshold, e.g. half the maximum distance, for two reasons:</p>
<ul>
<li>There are few pairs in of these bins, making estimates highly variable.</li>
<li>Not all pairs contribute (equally) to the largest distance classes (those in the center of the study area are not involved in very large distances).</li>
</ul>
</div>
<div id="c-alternative-measures-of-genetic-distances" class="section level3">
<h3 class="hasAnchor">
<a href="#c-alternative-measures-of-genetic-distances" class="anchor"></a>c) Alternative measures of genetic distances</h3>
<p>Which measure of genetic distance would provide the strongest Mantel correlation in the first distance class for this data set?</p>
<p>Here we will cycle through all genetic distance matrices in <code>GD.pop</code> and calculate a Mantel correlogram with Sturge’s rule (not linearized, method=“pearson”). This may take a while.</p>
<p>Note: the code that calculates <code>corm.GD.pop</code> is included here twice, first commented out, then with the option <code>include=FALSE</code>. This avoids printing out a lot of unnecessary output while still showing the (commented out) code in the .html version of the file.</p>
<div class="sourceCode" id="cb79"><html><body><pre class="r">#corm.GD.pop &lt;- lapply(GD.pop, function(x) EcoGenetics::eco.cormantel(M = x, 
#                      XY = ecoslot.XY(Frogs.ecopop)[,1:2],  nsim = 199, latlon=FALSE,
#                      alternative="less"))</pre></body></html></div>
<p>Next, we extract for each genetic distance matrix the observed value of the Mantel correlation for the first distance class and its p-value.</p>
<div class="sourceCode" id="cb80"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">corm.GD.pop</span>, <span class="kw">function</span>(<span class="no">x</span>) <span class="kw pkg">EcoGenetics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.OUT</a></span>(<span class="no">x</span>)<span class="kw">[[</span><span class="fl">1</span>]][<span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>,<span class="fl">4</span>)]))</pre></body></html></div>
<pre><code>##                            obs p.val
## pairwiseFst.hierfstat   0.3812 0.005
## propShared.PopGenReport 0.4815 0.005
## Nei.adegenet            0.4175 0.005
## Edwards.adegenet        0.4782 0.005
## Reynolds.adegenet       0.4337 0.005
## Rogers.adegenet         0.4704 0.005
## Provesti.adegenet       0.4815 0.005
## Joost.mmod              0.4331 0.005
## Hedrick.mmod            0.4331 0.005
## Nei.mmod                0.3698 0.005
## Euclidean.gstudio       0.4721 0.005
## cGD.gstudio             0.3647 0.005
## Nei.gstudio             0.4175 0.005
## Dps.gstudio             0.4074 0.005
## Jaccard.gstudio         0.4031 0.005</code></pre>
<p>Compare the p-values: for this dataset, all genetic distance measures resulted in significant spatial autocorrelation (indicating IBD).</p>
<p>Let’s plot the Mantel correlogram for <code>Nei.adegenet</code>. Statistically significant lags are shown in a different color than non-significant ones.</p>
<div class="sourceCode" id="cb82"><html><body><pre class="r"><span class="kw pkg">EcoGenetics</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/eco.plotCorrelog.html">eco.plotCorrelog</a></span>(<span class="no">corm.GD.pop</span>$<span class="no">Nei.adegenet</span>)</pre></body></html></div>
<p><strong>Questions:</strong></p>
<ul>
<li>Starting with the first distance class, how many consecutive distance classes showed significant spatial autocorrelation?</li>
<li>At what distance (range), roughly, did the positive autocorrelation disappear?</li>
</ul>
</div>
</div>
<div id="specify-spatial-weights-and-calculate-morans-i" class="section level2">
<h2 class="hasAnchor">
<a href="#specify-spatial-weights-and-calculate-morans-i" class="anchor"></a>6. Specify spatial weights and calculate Moran’s I</h2>
<p>In this part, we’ll quantify and test Moran’s I for the genetic diversity data as calculated in Week 3 lab.</p>
<p>Note: Above, we used a distance lag approach from geostatistics, here we use spatial neighbours and weights (neighbor topology). Either approach could be used with either type of data.</p>
<p>For a detailed tutorial on defining spatial neighbors and weights, see: <a href="https://cran.r-project.org/web/packages/adespatial/vignettes/tutorial.html#irregular-samplings" class="uri">https://cran.r-project.org/web/packages/adespatial/vignettes/tutorial.html#irregular-samplings</a></p>
<div id="a-defining-spatial-neighbors" class="section level3">
<h3 class="hasAnchor">
<a href="#a-defining-spatial-neighbors" class="anchor"></a>a) Defining spatial neighbors</h3>
<p>The function <code>chooseCN</code> (package: <code>adegenet</code>) provides an interface for choosing a connection network, i.e., for defining spatial neighbors. The underlying functions are defined in package <code>spdep</code> (for defining spatial dependences). It can return the following graph types:</p>
<ul>
<li>Delaunay triangulation (type 1)</li>
<li>Gabriel graph (type 2)</li>
<li>Relative neighbours (type 3)</li>
<li>Minimum spanning tree (type 4)</li>
<li>Neighbourhood by distance (type 5)</li>
<li>K nearests neighbours (type 6)</li>
<li>Inverse distances (type 7)</li>
</ul>
<p>Here we use types 1 - 6 to define neighbors in different ways. Then we plot each graph in geographic space. Lines indicate pairs of sites classified as neighbors.</p>
<p>Note: this function expects metric spatial coordinates (e.g., UTM).</p>
<div class="sourceCode" id="cb83"><html><body><pre class="r"><span class="no">nb.del</span> <span class="kw">&lt;-</span> <span class="kw pkg">adegenet</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/adegenet/man/chooseCN.html">chooseCN</a></span>(<span class="kw">xy</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.XY</a></span>(<span class="no">Frogs.ecopop</span>)[,<span class="fl">1</span>:<span class="fl">2</span>],
          <span class="kw">result.type</span> <span class="kw">=</span> <span class="st">"nb"</span>, <span class="kw">plot.nb</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<pre><code>## 
##      PLEASE NOTE:  The components "delsgs" and "summary" of the
##  object returned by deldir() are now DATA FRAMES rather than
##  matrices (as they were prior to release 0.0-18).
##  See help("deldir").
##  
##      PLEASE NOTE: The process that deldir() uses for determining
##  duplicated points has changed from that used in version
##  0.0-9 of this package (and previously). See help("deldir").</code></pre>
<div class="sourceCode" id="cb85"><html><body><pre class="r"><span class="no">nb.gab</span> <span class="kw">&lt;-</span> <span class="kw pkg">adegenet</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/adegenet/man/chooseCN.html">chooseCN</a></span>(<span class="kw">xy</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.XY</a></span>(<span class="no">Frogs.ecopop</span>)[,<span class="fl">1</span>:<span class="fl">2</span>],
          <span class="kw">result.type</span> <span class="kw">=</span> <span class="st">"nb"</span>, <span class="kw">plot.nb</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="fl">2</span>)
<span class="no">nb.rel</span> <span class="kw">&lt;-</span> <span class="kw pkg">adegenet</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/adegenet/man/chooseCN.html">chooseCN</a></span>(<span class="kw">xy</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.XY</a></span>(<span class="no">Frogs.ecopop</span>)[,<span class="fl">1</span>:<span class="fl">2</span>],
          <span class="kw">result.type</span> <span class="kw">=</span> <span class="st">"nb"</span>, <span class="kw">plot.nb</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="fl">3</span>)
<span class="no">nb.mst</span> <span class="kw">&lt;-</span> <span class="kw pkg">adegenet</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/adegenet/man/chooseCN.html">chooseCN</a></span>(<span class="kw">xy</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.XY</a></span>(<span class="no">Frogs.ecopop</span>)[,<span class="fl">1</span>:<span class="fl">2</span>],
          <span class="kw">result.type</span> <span class="kw">=</span> <span class="st">"nb"</span>, <span class="kw">plot.nb</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="fl">4</span>)
<span class="no">nb.nbd</span> <span class="kw">&lt;-</span> <span class="kw pkg">adegenet</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/adegenet/man/chooseCN.html">chooseCN</a></span>(<span class="kw">xy</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.XY</a></span>(<span class="no">Frogs.ecopop</span>)[,<span class="fl">1</span>:<span class="fl">2</span>],
          <span class="kw">result.type</span> <span class="kw">=</span> <span class="st">"nb"</span>, <span class="kw">plot.nb</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">d1</span><span class="kw">=</span><span class="fl">100</span>, <span class="kw">d2</span><span class="kw">=</span><span class="fl">15000</span>)
<span class="no">nb.4nn</span> <span class="kw">&lt;-</span> <span class="kw pkg">adegenet</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/adegenet/man/chooseCN.html">chooseCN</a></span>(<span class="kw">xy</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.XY</a></span>(<span class="no">Frogs.ecopop</span>)[,<span class="fl">1</span>:<span class="fl">2</span>],
          <span class="kw">result.type</span> <span class="kw">=</span> <span class="st">"nb"</span>, <span class="kw">plot.nb</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="fl">6</span>, <span class="kw">k</span> <span class="kw">=</span> <span class="fl">4</span>)

<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mfrow</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>,<span class="fl">3</span>), <span class="kw">mai</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>, <span class="fl">0.1</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">nb.del</span>, <span class="kw">coords</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.XY</a></span>(<span class="no">Frogs.ecopop</span>)); <span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="kw">main</span><span class="kw">=</span><span class="st">"Delaunay"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">nb.gab</span>, <span class="kw">coords</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.XY</a></span>(<span class="no">Frogs.ecopop</span>)); <span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="kw">main</span><span class="kw">=</span><span class="st">"Gabriel"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">nb.rel</span>, <span class="kw">coords</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.XY</a></span>(<span class="no">Frogs.ecopop</span>)); <span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="kw">main</span><span class="kw">=</span> <span class="st">"Rel. neighbors"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">nb.mst</span>, <span class="kw">coords</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.XY</a></span>(<span class="no">Frogs.ecopop</span>)); <span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="kw">main</span><span class="kw">=</span> <span class="st">"Min spanning tree"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">nb.nbd</span>, <span class="kw">coords</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.XY</a></span>(<span class="no">Frogs.ecopop</span>)); <span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="kw">main</span> <span class="kw">=</span> <span class="st">"Neighbor distance"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">nb.4nn</span>, <span class="kw">coords</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.XY</a></span>(<span class="no">Frogs.ecopop</span>)); <span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="kw">main</span> <span class="kw">=</span> <span class="st">"4 nearest neighbors"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mfrow</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">1</span>))</pre></body></html></div>
<p><img src="Week5_vignette_files/figure-html/unnamed-chunk-38-1.png" width="768"></p>
<p>For spatial statistics, spatial neighbors are used to calculate a local mean. We want each site to have multiple neighbors, but they should be nearby only. Gabriel graph (type = 2) is often a good option, and we’ll use it for the rest of this worked example.</p>
</div>
<div id="b-defining-spatial-weights" class="section level3">
<h3 class="hasAnchor">
<a href="#b-defining-spatial-weights" class="anchor"></a>b) Defining spatial weights</h3>
<p>By default, <code>chooseCN</code> returns row-standardized weights, so that for each site, the weights of its neighbors sum to 1. This means that a local mean can be calculated as a weighted mean of the other sites (non-neighboring sites have a weight of 0).</p>
<p>With the function <code>nb2mat</code> we can convert the neighbor object to a matrix of spatial weights. Let’s look at the first five lines and columns:</p>
<div class="sourceCode" id="cb86"><html><body><pre class="r"><span class="kw pkg">spdep</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/spdep/man/nb2mat.html">nb2mat</a></span>(<span class="no">nb.gab</span>)[<span class="fl">1</span>:<span class="fl">5</span>,<span class="fl">1</span>:<span class="fl">5</span>]</pre></body></html></div>
<pre><code>##   [,1]      [,2]      [,3]      [,4] [,5]
## 1    0 0.0000000 0.0000000 0.0000000    0
## 2    0 0.0000000 0.1666667 0.1666667    0
## 3    0 0.2500000 0.0000000 0.0000000    0
## 4    0 0.3333333 0.0000000 0.0000000    0
## 5    0 0.0000000 0.0000000 0.0000000    0</code></pre>
<p>Each row contains the weights for the neighbors of one site. We see that the third site is a neighbor of the second site and vice versa. However, the weights are not the same. It seems that site 2 has six neighbors, so each has a weight of 0.167, whereas site 3 has four neighbors, each with a weight of 0.25.</p>
</div>
<div id="c-calculating-and-testing-morans-i" class="section level3">
<h3 class="hasAnchor">
<a href="#c-calculating-and-testing-morans-i" class="anchor"></a>c) Calculating and testing Moran’s I</h3>
<p>Let’s see whether rarefied allelic richness, Ar, shows spatial autocorrelation among these sites.</p>
<div class="sourceCode" id="cb88"><html><body><pre class="r"><span class="kw pkg">spdep</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/spdep/man/moran.test.html">moran.test</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.C</a></span>(<span class="no">Frogs.ecopop</span>)$<span class="no">Ar</span>, <span class="kw pkg">spdep</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/spdep/man/nb2listw.html">nb2listw</a></span>(<span class="no">nb.gab</span>),
                  <span class="kw">alternative</span><span class="kw">=</span><span class="st">"greater"</span>)</pre></body></html></div>
<pre><code>## 
##  Moran I test under randomisation
## 
## data:  ecoslot.C(Frogs.ecopop)$Ar  
## weights: spdep::nb2listw(nb.gab)    
## 
## Moran I statistic standard deviate = 4.648, p-value = 1.676e-06
## alternative hypothesis: greater
## sample estimates:
## Moran I statistic       Expectation          Variance 
##        0.60990344       -0.03448276        0.01921995</code></pre>
<p>The test statistic is 0.61, and the p-value for a one-sided alternative “greater” (i.e., positive spatial autocorrelation) is <em>p</em> &lt; 0.0001. Thus, Ar showed strong and statistially significant spatial autocorrelation.</p>
<p>Let’s do this for all genetic diversity variables and extract the value of the Moran I statistics (for first neighbors) and its p-value.</p>
<div class="sourceCode" id="cb90"><html><body><pre class="r"><span class="no">Frogs.moran</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/EcoGenetics/man/EcoGenetics-accessors.html">ecoslot.C</a></span>(<span class="no">Frogs.ecopop</span>),
                       <span class="kw">function</span>(<span class="no">x</span>) <span class="kw pkg">spdep</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/spdep/man/moran.test.html">moran.test</a></span>(<span class="no">x</span>,
                       <span class="kw pkg">spdep</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/spdep/man/nb2listw.html">nb2listw</a></span>(<span class="no">nb.gab</span>), <span class="kw">alternative</span><span class="kw">=</span><span class="st">"two.sided"</span>))
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">obs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">Frogs.moran</span>, <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span>(<span class="no">x</span>$<span class="no">estimate</span>[<span class="fl">1</span>])),
<span class="kw">p.value</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">Frogs.moran</span>, <span class="kw">function</span>(<span class="no">x</span>) <span class="no">x</span>$<span class="no">p.value</span>)),<span class="fl">3</span>)</pre></body></html></div>
<pre><code>##         obs p.value
## n    -0.109   0.606
## Hobs  0.507   0.000
## Hexp  0.551   0.000
## Ar    0.610   0.000</code></pre>
<p><strong>Questions:</strong></p>
<ul>
<li>Which measure of genetic diversity showed the strongest autocorrelation?</li>
<li>Sample size n had a negative value of Moran’s I (obs). What does this mean?</li>
<li>Did all four variables show statistically significant spatial autocorrelation?</li>
</ul>
</div>
</div>
<div id="r-exercise-week-5" class="section level2">
<h2 class="hasAnchor">
<a href="#r-exercise-week-5" class="anchor"></a>7. R Exercise Week 5</h2>
<p><strong>Task:</strong> Assess fine-scale spatial genetic structure in <em>Pulsatilla vulgaris</em> within a single patch, A25: Test for IBD with Mantel rank correlation, and use a Mantel correlogram to assess the range of spatial autocorrelation.</p>
<p><strong>Hints:</strong></p>
<ol style="list-style-type: lower-alpha">
<li><p><strong>Load packages</strong>: You may want to load the packages <code>dplyr</code>, <code>EcoGenetics</code> and <code>adegenet</code>. Alternatively, you can use <code>::</code> to call functions from packages.</p></li>
<li>
<p><strong>Import data, extract adults from A25</strong>.</p>
<ul>
<li>Use the code below to import the data into gstudio.</li>
<li>Inspect a few rows of the data.</li>
<li>Filter the dataset to retain adults (OffID == 0) from site A25 (Population == “A25”).</li>
</ul>
</li>
</ol>
<div class="sourceCode" id="cb92"><html><body><pre class="r"><span class="no">Pulsatilla.gstudio</span> <span class="kw">&lt;-</span> <span class="kw pkg">gstudio</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/gstudio/man/read_population.html">read_population</a></span>(<span class="kw">path</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>,
                            <span class="st">"pulsatilla_genotypes.csv"</span>,
                            <span class="kw">package</span> <span class="kw">=</span> <span class="st">"LandGenCourse"</span>),
                    <span class="kw">type</span><span class="kw">=</span><span class="st">"column"</span>, <span class="kw">locus.columns</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">6</span>:<span class="fl">19</span>),
                    <span class="kw">phased</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">sep</span><span class="kw">=</span><span class="st">","</span>, <span class="kw">header</span><span class="kw">=</span><span class="fl">TRUE</span>)</pre></body></html></div>
<ol start="3" style="list-style-type: lower-alpha">
<li><p><strong>Plot locations of individuals</strong>: use <code>plot</code> with the argument <code>asp = 1</code> to plot the locations of the sampled individuals from site A25 to scale.</p></li>
<li><p><strong>Convert to ecogen and genind</strong>: use <code><a href="https://rdrr.io/pkg/EcoGenetics/man/ecogen2gstudio.html">EcoGenetics::gstudio2ecogen</a></code> to convert to an <code>ecogen</code> object. From there, use <code><a href="https://rdrr.io/pkg/EcoGenetics/man/ecogen2genind.html">EcoGenetics::ecogen2genind</a></code> to convert to a <code>genind</code> object.</p></li>
<li>
<p><strong>Calculate genetic and Euclidean distance</strong>:</p>
<ul>
<li>Use <code><a href="https://rdrr.io/pkg/adegenet/man/propShared.html">adegenet::propShared</a></code> to calculate the proportion of shared alleles at the individual level. (Do not convert to genpop).</li>
<li>Convert to a distance measure by calculating <code>1 - propShared</code>.</li>
<li>Check object class. If it is not <code>dist</code>, use <code>as.dist</code> to convert to a <code>dist</code> object.</li>
<li>Use <code>dist</code> to calculate Euclidean distance between individuals.</li>
</ul>
</li>
<li>
<p><strong>Mantel test</strong>:</p>
<ul>
<li>Adapt code from section 4.a to plot pairwise genetic distance against Euclidean distance.</li>
<li>Do you notice something unusial in the plot? Why are there so few different values of genetic distance?</li>
<li>Do you think there is spatial autocorrelation? If so, up to what distance?</li>
<li>Adapt code from section 4.b to test for IBD with a Mantel test, using Spearman rank correlation.</li>
</ul>
</li>
<li><p><strong>Mantel correlogram</strong>: adapt code from section 5.a to create and plot a Mantel correlogram. Interpret the results.</p></li>
</ol>
<p><strong>Questions:</strong> What is the range of spatial autocorrelation in <em>P. vulgaris</em> in site A25?</p>
<ul>
<li>Based on a plot of genetic distance against Euclidean distance?</li>
<li>Based on where the Mantel correlogram reaches 0?</li>
<li>Based on statistical significance tests for the Mantel correlogram (with default settings: one-sided alternative “less”, Holm’s adjustment)?</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://sites.utm.utoronto.ca/wagnerlab/">Helene Wagner</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
